import keras
from keras.models import load_model
from keras.preprocessing.image import img_to_array, load_img

import numpy as np
import cv2

def runner(s):
	model = load_model('./machinelearning/mnist_keras_cnn_model.h5')

	model.compile(loss=keras.losses.categorical_crossentropy,
              optimizer=keras.optimizers.Adam(),
              metrics=['accuracy'])

	return model.predict(s)


def pre_process(raw_input):
	res = []

	for x in raw_input:
		x = np.array(x)
		x = x.reshape(1, 28, 28, 1)
		out = [int(y+0.5) for y in runner(x).tolist()[0]]
		res.append(out.index(1))

	return res



# raw_data = {"question":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,106,121,171,252,224,128,87,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,181,284,241,288,260,287,266,244,29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,172,263,263,242,182,156,154,287,277,134,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,46,217,264,191,28,12,0,6,197,271,145,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,78,227,229,23,0,0,0,109,269,230,57,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,34,19,0,0,0,0,211,270,253,67,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,122,247,269,209,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,79,266,287,197,57,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,278,279,124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,224,286,172,11,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,28,245,281,228,35,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,222,287,122,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,73,254,238,215,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,223,228,272,134,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,117,227,236,190,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,225,240,281,27,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,252,275,49,22,19,21,23,5,0,5,21,19,36,145,171,153,146,11,0,0,0,0,0,0,0,0,0,241,253,218,263,272,272,287,284,148,137,177,261,281,236,229,234,215,238,124,0,0,0,0,0,0,0,0,0,180,229,269,215,215,280,236,263,225,275,284,244,272,268,258,180,107,113,51,0,0,0,0,0,0,0,0,0,0,134,131,123,111,177,237,285,225,159,112,117,37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]}

# r = np.array(raw_data["question"][0])

# # img = load_img('C:/data/testvalidate.jpg') # this is a PIL image
# # print(img)

# # # array = img_to_array(img)
# # print(r)
    
# # arrayresized = cv2.resize(r, (28,28))
# # # print(arrayresized) # this is a Numpy array with shape (3, 150, 150)

# # inputarray = arrayresized[np.newaxis,...] # dimension added to fit input size

# # print(r.shape)

# r = r.reshape(1, 28, 28, 1)

# runner(r)

